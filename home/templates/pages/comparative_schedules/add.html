{% extends 'layouts/base.html' %}
{% load static %}

{% block title %} Dashboard {% endblock title %}
{% block content %}

<!-- [ Main Content ] start -->
<div class="pc-container">
    <div class="pc-content">
      <!-- [ Main Content ] start -->
      <div class="row">
        <!-- [ sample-page ] start -->
       
        <form class="row g-3">

            <!-- <div class="col-md-6">
                <label  class="form-label">request_id:</label>
                <input type="text" class="form-control" id="request_id" name="request_id" value="">
            </div> -->

            <div class="col-md-12">
                <label  class="form-label">Select Purchase Request:</label>
                <select class="form-control" name="purchase_request" id="purchase_request">
                    <option value="None">..</option>
    
                    </select>           
           </div>




            <legend>Supplier 1</legend>
            
            <div class="col-md-6">
                <label  class="form-label">Supplier 1 (Company Name):</label>
                <input type="text" class="form-control" id="company_name_supplier1" name="company_name_supplier1" value="">
            </div>

            <div class="col-md-6">
                <label  class="form-label">Item Name. (Supplier 1):</label>
                <input type="text" class="form-control" id="item_name_supplier1" name="item_name_supplier1" value="" readonly>
            </div>

            <div class="col-md-12">
                <label  class="form-label"> Description:</label>
                <textarea type="text" class="form-control" id="desc_supplier1" name="desc_supplier1" value="" readonly></textarea>
            </div>

            <div class="col-md-4">
                <label  class="form-label">Qty:</label>
                <input type="number" class="form-control" id="qnty_supplier1" name="qnty_supplier1" value="" readonly>
            </div>
            
            <div class="col-md-4">
                <label  class="form-label">Unit Price:</label>
                <input type="number" class="form-control" id="unit_price_supplier1" name="unit_price_supplier1" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Total Price:</label>
                <input type="number" class="form-control" id="total_price_supplier1" name="total_price_supplier1" value="" readonly>
            </div>

            <hr>

            <legend>Supplier 2</legend>
            <div class="col-md-6">
                <label  class="form-label">Supplier 2 (Company Name):</label>
                <input type="text" class="form-control" id="company_name_supplier2" name="company_name_supplier2" value="">
            </div>

            <div class="col-md-6">
                <label  class="form-label">Item Name. (supplier 2):</label>
                <input type="text" class="form-control" id="item_name_supplier2" name="item_name_supplier2" value="" readonly>
            </div>

            <div class="col-md-12">
                <label  class="form-label">Description:</label>
                <textarea type="text" class="form-control" id="desc_supplier2" name="desc_supplier2" value="" readonly></textarea>
            </div>

            <div class="col-md-4">
                <label  class="form-label">Qty:</label>
                <input type="number" class="form-control" id="qnty_supplier2" name="qnty_supplier2" value="" readonly>
            </div>
            
            <div class="col-md-4">
                <label  class="form-label">Unit price:</label>
                <input type="number" class="form-control" id="unit_price_supplier2" name="unit_price_supplier2" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Total Price:</label>
                <input type="number" class="form-control" id="total_price_supplier2" name="total_price_supplier2" value="" readonly>
            </div>

            <hr>
            
            <legend>Supplier 3</legend>
            <div class="col-md-6">
                <label  class="form-label">Supplier 3 (Company Name):</label>
                <input type="text" class="form-control" id="company_name_supplier3" name="company_name_supplier3" value="">
            </div>

            <div class="col-md-6">
                <label  class="form-label">Item Name:</label>
                <input type="text" class="form-control" id="item_name_supplier3" name="item_name_supplier3" value="" readonly>
            </div>

            <div class="col-md-12">
                <label  class="form-label">Description:</label>
                <textarea type="text" class="form-control" id="desc_supplier3" name="desc_supplier3" value="" readonly></textarea>
            </div>

            <div class="col-md-4">
                <label  class="form-label">Qty:</label>
                <input type="number" class="form-control" id="qnty_supplier3" name="qnty_supplier3" value="" readonly>
            </div>

            <div class="col-md-4">
                <label  class="form-label">Unit Price:</label>
                <input type="number" class="form-control" id="unit_price_supplier3" name="unit_price_supplier3" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Total Price:</label>
                <input type="number" class="form-control" id="total_price_supplier3" name="total_price_supplier3" value="" readonly>
            </div>
            
            <hr>

            <div class="col-md-4">
                <label  class="form-label">Recommended Supplier:</label>
                <input type="text" class="form-control" id="recommended_supplier" name="recommended_supplier" value="">
            </div>

            <div class="col-md-8">
                <label  class="form-label">Reasons for recommendations:</label>
                <textarea type="text" class="form-control" id="recommended_supplier_reason" name="recommended_supplier_reason" value=""></textarea>
            </div>

            <hr>


            
            <!-- <div class="col-md-12">
                <label  class="form-label">Upload file</label>
                <input type="file" class="form-control" id="upload" value="" name="upload" accept=".doc, .docx, .pdf, .txt">
            </div> -->

            

            <hr>
<!-- 
            <div class="col-md-4">
                <label  class="form-label">Requested By:</label>
                <input type="text" class="form-control" id="requested_by" name="requested_by" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Signature:</label>
                <input type="text" class="form-control" id="requested_by_sig" name="requested_by_sig" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Date:</label>
                <input type="text" class="form-control" id="requested_by_date" name="requested_by_date" value="">
            </div>
            
            <hr> -->

            <div class="col-md-12">
                <label  class="form-label">Select Technical Person:</label>
                <select class="form-control" name="tech_person_by" id="tech_person_by">
                    <option value="None">..</option>
    
                    </select>            </div>
<!-- 
            <div class="col-md-4">
                <label  class="form-label">Signature:</label>
                <input type="text" class="form-control" id="tech_person_by_sig" name="tech_person_by_sig" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Date:</label>
                <input type="text" class="form-control" id="tech_person_date" name="tech_person_date" value="">
            </div>

            <hr>

            <div class="col-md-4">
                <label  class="form-label">Dept Head:</label>
                <input type="text" class="form-control" id="dpt_head_by" name="dpt_head_by" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Signature:</label>
                <input type="text" class="form-control" id="dpt_head_by_sig" name="dpt_head_by_sig" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Date:</label>
                <input type="text" class="form-control" id="dpt_head_date" name="dpt_head_date" value="">
            </div>

            <hr>

            <div class="col-md-4">
                <label  class="form-label">Coordinator/Team Lead:</label>
                <input type="text" class="form-control" id="team_lead_by" name="team_lead_by" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Signature:</label>
                <input type="text" class="form-control" id="team_lead_by_sig" name="team_lead_by_sig" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Date:</label>
                <input type="text" class="form-control" id="team_lead_date" name="team_lead_date" value="">
            </div>

            <hr>

            <div class="col-md-4">
                <label  class="form-label">Approved by:(DG/PI):</label>
                <input type="text" class="form-control" id="approved_by" name="approved_by" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Signature:</label>
                <input type="text" class="form-control" id="approved_by_sig" name="approved_by_sig" value="">
            </div>

            <div class="col-md-4">
                <label  class="form-label">Date:</label>
                <input type="text" class="form-control" id="approved_date" name="approved_date" value="">
            </div>
            <hr> -->
          </form> 

          <div class="col-md-12" style="margin-top: 3%;">
            <a onclick="sendEdit();" id="approve" class="btn btn-primary"> SUBMIT</a>

            <script  language="JavaScript" type="text/javascript">








$('#unit_price_supplier3').on('change', function (e) {
    var optionSelected = $("option:selected", this);
    var valueSelected = this.value;


    var unit_cost3 = $("#unit_price_supplier3").val();
    var qnty3 = $("#qnty_supplier3").val();
    $("#total_price_supplier3").val(unit_cost3*qnty3); 


});







$('#purchase_request').on('change', function (e) {
    var optionSelected = $("option:selected", this);
    var valueSelected = this.value;

    // alert(valueSelected);




    const url1 = "  https://lorkas.co.zw/procurement/purchase_request_get_record"
                    const data1 = {
                      'id':valueSelected,
                    }
            
                      $.post(url1,data1, function(data1,status){
                        console.log(data1)


                        $("#item_name_supplier1").val(data1['item_name']);
                        $("#desc_supplier1").val(data1['description']);

                        $("#qnty_supplier1").val(data1['qnty']); 

                        $("#item_name_supplier2").val(data1['item_name']);
                        $("#desc_supplier2").val(data1['description']);
                        $("#qnty_supplier2").val(data1['qnty']); 

                        $("#item_name_supplier3").val(data1['item_name']);
                        $("#desc_supplier3").val(data1['description']);
                        $("#qnty_supplier3").val(data1['qnty']); 


                        $('#overlay').fadeOut();

        });


    
});


function autofill(){








}









// populate the service requests dropdown

const url1 = "  https://lorkas.co.zw/procurement/get_purchase_requests"
                    const data1 = {
                      'id':"case_id",
                    }
            
                      $.post(url1,data1, function(data1,status){
                        console.log(data1)
                        $.each(data1, function(val, text) {
                            $('#purchase_request').append( new Option(text,val) );
                        });
                        $('#overlay').fadeOut();

        });




// populate the users dropdown

const url = "  https://lorkas.co.zw/procurement/get_users"
                    const data = {
                      'id':"case_id",
                    }
                      $.post(url,data, function(data,status){
                        console.log(data)
                        $.each(data, function(val, text) {
                            $('#tech_person_by').append( new Option(text,val) );
                        });
                        $('#overlay').fadeOut();
        });


                    function sendEdit(){
                        $('#approve').prop('disabled', true);

                        // var request_id= document.getElementById('request_id').value;
                        
                        // var upload= document.getElementById('upload').files[0];
                      
var company_name_supplier1= $("#company_name_supplier1").val();
var item_name_supplier1= $("#item_name_supplier1").val();
var desc_supplier1= $("#desc_supplier1").val();
var qnty_supplier1= $("#qnty_supplier1").val();
var unit_price_supplier1= $("#unit_price_supplier1").val();
var total_price_supplier1= $("#total_price_supplier1").val();

var company_name_supplier2= $("#company_name_supplier2").val();
var item_name_supplier2= $("#item_name_supplier2").val();
var desc_supplier2= $("#desc_supplier2").val();
var qnty_supplier2= $("#qnty_supplier2").val();
var unit_price_supplier2= $("#unit_price_supplier2").val();
var total_price_supplier2= $("#total_price_supplier2").val();

var company_name_supplier3= $("#company_name_supplier3").val();
var item_name_supplier3= $("#item_name_supplier3").val();
var desc_supplier3= $("#desc_supplier3").val();
var qnty_supplier3= $("#qnty_supplier3").val();
var unit_price_supplier3= $("#unit_price_supplier3").val();
var total_price_supplier3= $("#total_price_supplier3").val();

var recommended_supplier= $("#recommended_supplier").val();
var recommended_supplier_reason= $("#recommended_supplier_reason").val();

var purchase_request= $("#purchase_request").val();


var tech_person_by= $("#tech_person_by").val();
                        
                            current_url = window.location.href;
                            arr = current_url.split("_");
                            case_id = arr.at(-1);
                        console.log(case_id);
                        if (case_id == "add"){
                
                        const url = "  https://lorkas.co.zw/procurement/comp_schedule_send_record";
                        // current_url = window.location.href;
                        // arr = current_url.split("/");
                        // case_id = arr.at(-1);
                        // month_id =arr[arr.length - 2];
                        console.log("after url");
                        const data = {
                            // "request_id": request_id,
                                            // "upload": upload,
                                            "company_name_supplier1": company_name_supplier1,
                                            "item_name_supplier1": item_name_supplier1,
                                            "desc_supplier1": desc_supplier1,
                                            "qnty_supplier1":qnty_supplier1,
                                            "unit_price_supplier1":unit_price_supplier1,
                                            "total_price_supplier1": total_price_supplier1,

                                            "company_name_supplier2": company_name_supplier2,
                                            "item_name_supplier2": item_name_supplier2,
                                            "desc_supplier2": desc_supplier2,
                                            "qnty_supplier2":qnty_supplier2,
                                            "unit_price_supplier2":unit_price_supplier2,
                                            "total_price_supplier2": total_price_supplier2,

                                            "company_name_supplier3": company_name_supplier3,
                                            "item_name_supplier3": item_name_supplier3,
                                            "desc_supplier3": desc_supplier3,
                                            "qnty_supplier3":qnty_supplier3,
                                            "unit_price_supplier3":unit_price_supplier3,
                                            "total_price_supplier3": total_price_supplier3,

                                            "recommended_supplier": recommended_supplier,
                                            "recommended_supplier_reason": recommended_supplier_reason,

                                            "purchase_request":purchase_request,
                                            // "requested_by_sig":requested_by_sig,
                                            // "requested_by_date": requested_by_date,

                                            "tech_person_by": tech_person_by,
                                            // "tech_person_by_sig": tech_person_by_sig,
                                            // "tech_person_date": tech_person_date,

                                            // "dpt_head_by":dpt_head_by,
                                            // "dpt_head_by_sig":dpt_head_by_sig,
                                            // "dpt_head_date": dpt_head_date,

                                            // "team_lead_by": team_lead_by,
                                            // "team_lead_by_sig": team_lead_by_sig,
                                            // "team_lead_date": team_lead_date,

                                            // "approved_by":approved_by,
                                            // "approved_by_sig":approved_by_sig,
                                            // "approved_date": approved_date,
                                           }
                
                                console.log("after dict");
                        $.post(url,data, function(data,status){
                        if (data['message']=="success"){
                            console.log("success")
                            alert(data['message']);
                            window.location.href="  https://lorkas.co.zw/procurement/comp_schedule_quotes_upload/"+data['id'];
                        }else{
                            console.log(data['message'])
                            alert(data['message']);
                            return;
                        }
                
                        });
                        // alert("stop hee");
                    }else{
                
                        const url = "  https://lorkas.co.zw/procurement/purchase_request_edit_record/";
                        // current_url = window.location.href;
                        // arr = current_url.split("/");
                        // case_id = arr.at(-1);
                        // month_id =arr[arr.length - 2];
                
                
                
                        const data = {
                            // "request_id": request_id,
                                            "payee": payee,

                                            // "upload": upload,
                                            "company_name_supplier1": company_name_supplier1,
                                            "item_number_supplier1": item_number_supplier1,
                                            "desc_supplier1": desc_supplier1,
                                            "qnty_supplier1":qnty_supplier1,
                                            "unit_price_supplier1":unit_price_supplier1,
                                            "total_price_supplier1": total_price_supplier1,

                                            "company_name_supplier2": company_name_supplier2,
                                            "item_number_supplier2": item_number_supplier2,
                                            "desc_supplier2": desc_supplier2,
                                            "qnty_supplier2":qnty_supplier2,
                                            "unit_price_supplier2":unit_price_supplier2,
                                            "total_price_supplier2": total_price_supplier2,

                                            "company_name_supplier3": company_name_supplier3,
                                            "item_number_supplier3": item_number_supplier3,
                                            "desc_supplier3": desc_supplier3,
                                            "qnty_supplier3":qnty_supplier3,
                                            "unit_price_supplier3":unit_price_supplier3,
                                            "total_price_supplier3": total_price_supplier3,

                                            "recommended_supplier": recommended_supplier,
                                            "recommended_supplier_reason": recommended_supplier_reason,
                                            "dpt_project_requesting": dpt_project_requesting,

                                            "service_request":service_request,
                                            // "requested_by_sig":requested_by_sig,
                                            // "requested_by_date": requested_by_date,

                                            // "tech_person_by": tech_person_by,
                                            // "tech_person_by_sig": tech_person_by_sig,
                                            // "tech_person_date": tech_person_date,

                                            // "dpt_head_by":dpt_head_by,
                                            // "dpt_head_by_sig":dpt_head_by_sig,
                                            // "dpt_head_date": dpt_head_date,

                                            // "team_lead_by": team_lead_by,
                                            // "team_lead_by_sig": team_lead_by_sig,
                                            // "team_lead_date": team_lead_date,

                                            // "approved_by":approved_by,
                                            // "approved_by_sig":approved_by_sig,
                                            // "approved_date": approved_date,
                                        };
                
                
                
                
                        
                      
                
                        $.post(url,data, function(data,status){
                          window.location.replace("  https://lorkas.co.zw/procurement/comp_schedule_view/"+case_id);
                
                        console.log(data);
                        if (data['message']=="success"){
                            alert("success");
                            window.location.replace("  https://lorkas.co.zw/procurement/comp_schedule_view/"+case_id);
                        }else{
                            alert(data['message']);
                            window.location.replace("  https://lorkas.co.zw/procurement/comp_schedule_view/"+case_id);
                
                            // window.location.href="/view_record/"+case_id;
                
                        }
                
                        });
                
                
                
                
                
                    }
                
                    }
                        </script>
{% endblock content %}